{% extends "admin/base.html" %}

{% block content %}
<div class="container mt-4">
    <h2 class="mb-4">Ajouter un Professeur</h2>

    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        {% for category, message in messages %}
            <div class="alert alert-{{ category }} alert-dismissible fade show mt-3" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        {% endfor %}
    {% endif %}
{% endwith %}

        {% if error %}
    <div class="alert alert-danger">
        {{ error }}
    </div>
    {% endif %}

    <form action="{{ url_for('admin_bp.add_teacher') }}" method="POST">
        {{ form.hidden_tag() }}

        <div class="row">
            <div class="col-md-6">
                <div class="mb-3">
                    {{ form.username.label(class="form-label") }}
                    {{ form.username(class="form-control") }}
                </div>

                <div class="mb-3">
                    {{ form.password.label(class="form-label") }}
                    {{ form.password(class="form-control") }}
                </div>

                <div class="mb-3">
                    {{ form.first_name.label(class="form-label") }}
                    {{ form.first_name(class="form-control") }}
                </div>

                <div class="mb-3">
                    {{ form.last_name.label(class="form-label") }}
                    {{ form.last_name(class="form-control") }}
                </div>
            </div>

            <div class="col-md-6">
                <div class="mb-3 border p-3 rounded">
                    <label class="form-label fw-bold">Classes :</label>
                    {% for value, label in form.classes.choices %}
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="classes" value="{{ value }}" id="class{{ value }}">
                            <label class="form-check-label" for="class{{ value }}">{{ label }}</label>
                        </div>
                    {% endfor %}
                </div>

                <div class="mb-3 border p-3 rounded">
                    <label class="form-label fw-bold">Matières :</label>
                    {% for value, label in form.subjects.choices %}
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="subjects" value="{{ value }}" id="subject{{ value }}">
                            <label class="form-check-label" for="subject{{ value }}">{{ label }}</label>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- Boutons -->
        <div class="mt-4 text-center">
            <button type="submit" class="btn btn-primary px-4">Ajouter le Professeur</button>
            <a href="{{ url_for('admin_bp.list_teachers') }}" class="btn btn-secondary px-4">Annuler</a>
        </div>
    </form>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const form = document.querySelector("form");
            const subjectsCheckboxes = document.querySelectorAll("input[name='subjects']");
            const subjectError = document.createElement("div");
    
            subjectError.classList.add("alert", "alert-danger", "mt-2", "d-none");
            subjectError.innerText = "❌ Vous devez sélectionner au moins une matière.";
            form.insertBefore(subjectError, form.firstChild);
    
            form.addEventListener("submit", function (event) {
                let atLeastOneChecked = false;
    
                // Vérifie si au moins une matière est cochée
                subjectsCheckboxes.forEach(checkbox => {
                    if (checkbox.checked) {
                        atLeastOneChecked = true;
                    }
                });
    
                if (!atLeastOneChecked) {
                    event.preventDefault();  // Bloque temporairement l'envoi
                    subjectError.classList.remove("d-none");  // Affiche le message d'erreur
                }
            });
        });
    </script>
    
</div>
{% endblock %}
